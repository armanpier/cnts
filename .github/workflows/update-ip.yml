name: Update server IP for selected ports

on:
  workflow_dispatch:
    inputs:
      new_server:
        description: 'New server IP or domain'
        required: true
        default: '127.0.0.1'

 jobs:
   update-server:
     runs-on: ubuntu-latest

     steps:
-      - name: Checkout code
-        uses: actions/checkout@v4
-        with:
-          fetch-depth: 0
+      - name: Checkout code (clean)
+        uses: actions/checkout@v4
+        with:
+          fetch-depth: 0     # full history, required for rebase
+          clean: true        # remove any untracked/modified files

       - name: Write updater script
         run: |
           cat > update_server.py << 'PY'
           â€¦ your Python here â€¦
           PY

       - name: Run updater on test
         run: |
           NEW="${{ github.event.inputs.new_server }}"
           python3 update_server.py "$NEW" test

       - name: Commit & push if changed
         run: |
           git config --global user.name "github-actions[bot]"
           git config --global user.email "github-actions[bot]@users.noreply.github.com"
-          git pull origin main --rebase
+          git pull origin main --rebase
           git add test
           git diff --quiet --cached || git commit -m "Update server to ${{ github.event.inputs.new_server }}"
           git push origin main
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

